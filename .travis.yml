os: linux

dist: xenial

git:
  depth: 1

language: node_js

node_js:
  - 13.12.0 # Use Find and Replace to change

cache: npm

notifications:
  email: false

branches:
  only:
    - master
    - /^([0-9]|[1-9][0-9]*)\.([0-9]|[1-9][0-9]*)\.([0-9]|[1-9][0-9]*)(?:-([0-9A-Za-z-]+(?:\.[0-9A-Za-z-]+)*))?(?:\+[0-9A-Za-z-]+)?$/ # Semver, for pushed tags

jobs:
  include:
    - stage: Check
      script: npm run check:lint
      name: Lint

    - script: npm run check:typescript
      name: TypeScript

    - script: npm run check:coverage
      name: Test and coverage

    - script: npm run check:npm-audit
      name: npm audit

    - script: npm run check:depcheck
      name: npm run check:depcheck

    - stage: Deploy
      os: osx
      name: Deploy
      script: "# Deploying..."
      deploy:
        provider: releases
        name: Orange v$TRAVIS_TAG
        tag_name: $TRAVIS_TAG
        token:
          secure: ppRAt+1dAxJwyKhEGiIPWdD9sBB2XqwEghEA0sSFbYA3vpMZeb8LTD0kz5g3L5u5BAZtD5f2uMaO7W5JTAWp+7BFAIB5d3j978BjwmcDLWv8a1w2EHEOEch1QKhUmdFlFZRJfCrUBHu9EOA8EGqToM/pzpvTajWphNEO0vWmcbhdYgjkrL+VXIgU3aq0CW1fKMrFPevVb0hjUSh+wsWiW2RkLBxHU8XinfkMEvTZQOKdVWD+EhjpyDjhwuR+XeHnNmq2ve3rv17Qlrvd1dngAdAjNmps6Yk6nnkJqOyWCSz89G+8WH79uFTh4V2aSx+9YtQrvzmSZjFOC11dmbCj31rWbZ82RRvPI2gapbkvDbVKAwpuakpHO2NSZvumegfD0p+kvyyMon3ZNANZdLUqr0JNu4knKuJu5BCltuNHP/CJ5THe/A+xtUJZMaUjTot4Nvz8t+PBMJhfk3aEX54vqhKmOIw8xrcyU9QCrKSm4jT8Y5m5b1pXktYCLaawQrHn9jgoQxn/y/RWmfRB2FejO1voZB9gGG3PFbh8j/M+iANJY+lCViIRL/xpPXj9kkzXhxsxlCdEOofvIkszCVK7tfedmkEt6/YvDDF/S5q1Qx9QWDHupCY37U8Mzr3MtbipuE7h8IFHsb/g3LGeC2V7i4QI61S8m0bZnsOCas6f2a0=
        file: artifacts/electronPackager/Orange-macOS-$TRAVIS_TAG.zip
        draft: true
        on:
          tags: true
        edge: true

      before_deploy: npm run create-package
